name: ×‘×“×™×§×ª ××™×›×•×ª ×§×•×“ ××§×™×¤×”

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:  # ×”×¤×¢×œ×” ×™×“× ×™×ª

jobs:
  code-quality:
    runs-on: ubuntu-latest
    name: ğŸ” ×‘×“×™×§×•×ª ××™×›×•×ª ×§×•×“
    
    steps:
    - name: ğŸ“¥ Checkout ×§×•×“
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ ×”×ª×§× ×ª dependencies
      run: npm ci --only=dev
      
    - name: ğŸ” TypeScript Type Check
      run: |
        echo "ğŸ” ×‘×•×“×§ TypeScript types..."
        npx tsc --noEmit --strict
        echo "âœ… TypeScript type check ×”×•×©×œ× ×‘×”×¦×œ×—×”"
      continue-on-error: false
      
    - name: ğŸ¯ ESLint ×‘×“×™×§×”
      run: |
        echo "ğŸ¯ ××¨×™×¥ ESLint..."
        npx eslint . --max-warnings=0
        echo "âœ… ESLint ×‘×“×™×§×” ×”×•×©×œ××” ×‘×”×¦×œ×—×”"
      continue-on-error: false
      
    - name: ğŸ§¹ Prettier ×‘×“×™×§×ª ×¤×•×¨××˜
      run: |
        echo "ğŸ§¹ ×‘×•×“×§ ×¤×•×¨××˜ ×§×•×“..."
        npx prettier --check "src/**/*.{ts,tsx,js,jsx,css,json}"
        echo "âœ… ×¤×•×¨××˜ ×§×•×“ ×ª×§×™×Ÿ"
      continue-on-error: false
      
    - name: ğŸ”’ ×‘×“×™×§×ª ××‘×˜×—×” - npm audit
      run: |
        echo "ğŸ”’ ×‘×•×“×§ ×—×•×œ×©×•×ª ××‘×˜×—×”..."
        npm audit --audit-level=moderate
        echo "âœ… ×‘×“×™×§×ª ××‘×˜×—×” ×”×•×©×œ××”"
      continue-on-error: true
      
    - name: ğŸ“Š ×‘×“×™×§×ª Dependencies
      run: |
        echo "ğŸ“Š ×‘×•×“×§ dependencies..."
        npm ls --depth=0
        echo "âœ… Dependencies ×ª×§×™× ×™×"
      continue-on-error: true
      
    - name: ğŸª ×‘×“×™×§×ª Circular Dependencies
      run: |
        echo "ğŸª ×‘×•×“×§ circular dependencies..."
        npx madge --circular --extensions ts,tsx,js,jsx src/
        echo "âœ… ××™×Ÿ circular dependencies"
      continue-on-error: true
      
    - name: ğŸ“ ×‘×“×™×§×ª ×’×•×“×œ Bundle (×××™×“×”)
      run: |
        echo "ğŸ“ ××¢×¨×™×š ×’×•×“×œ bundle..."
        npx bundlesize-analyzer src/ --estimate-only
        echo "âœ… ×××™×“×ª ×’×•×“×œ bundle ×”×•×©×œ××”"
      continue-on-error: true
      
    - name: ğŸŒ ×‘×“×™×§×ª Accessibility
      run: |
        echo "ğŸŒ ×‘×•×“×§ accessibility..."
        npx axe-cli --tags wcag2a,wcag2aa,wcag21aa --show-errors src/ || true
        echo "âœ… ×‘×“×™×§×ª accessibility ×”×•×©×œ××”"
      continue-on-error: true
      
    - name: ğŸ“‹ ×“×•×— ×¡×™×›×•×
      if: always()
      run: |
        echo "ğŸ“‹ ×“×•×— ×¡×™×›×•× ×‘×“×™×§×•×ª ××™×›×•×ª ×§×•×“:"
        echo "=================================="
        echo "ğŸ” TypeScript Type Check: ${{ steps.typescript.outcome || '×”×•×©×œ×' }}"
        echo "ğŸ¯ ESLint: ${{ steps.eslint.outcome || '×”×•×©×œ×' }}"
        echo "ğŸ§¹ Prettier: ${{ steps.prettier.outcome || '×”×•×©×œ×' }}"
        echo "ğŸ”’ Security Audit: ${{ steps.security.outcome || '×”×•×©×œ×' }}"
        echo "ğŸ“Š Dependencies: ${{ steps.deps.outcome || '×”×•×©×œ×' }}"
        echo "=================================="
        
  performance-check:
    runs-on: ubuntu-latest
    name: âš¡ ×‘×“×™×§×•×ª ×‘×™×¦×•×¢×™×
    
    steps:
    - name: ğŸ“¥ Checkout ×§×•×“
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ ×”×ª×§× ×ª dependencies
      run: npm ci --only=dev
      
    - name: ğŸ“ˆ × ×™×ª×•×— Bundle Size
      run: |
        echo "ğŸ“ˆ ×× ×ª×— ×’×•×“×œ components..."
        find src/ -name "*.tsx" -o -name "*.ts" | head -20 | xargs wc -l | sort -nr
        echo "âœ… × ×™×ª×•×— ×’×•×“×œ ×§×‘×¦×™× ×”×•×©×œ×"
        
    - name: ğŸ¯ ×‘×“×™×§×ª Dead Code
      run: |
        echo "ğŸ¯ ××—×¤×© ×§×•×“ ××ª..."
        npx ts-unused-exports tsconfig.json --searchNamespaces --ignoreLocallyUsed
        echo "âœ… ×‘×“×™×§×ª dead code ×”×•×©×œ××”"
      continue-on-error: true
        
    - name: ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª ×¤×¨×•×™×§×˜
      run: |
        echo "ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª ×¤×¨×•×™×§×˜:"
        echo "====================="
        echo "ğŸ“ ×¡×š ×”×›×œ ×§×‘×¦×™ TypeScript:"
        find src/ -name "*.ts" -o -name "*.tsx" | wc -l
        echo "ğŸ“„ ×¡×š ×”×›×œ ×©×•×¨×•×ª ×§×•×“:"
        find src/ -name "*.ts" -o -name "*.tsx" | xargs wc -l | tail -1
        echo "ğŸ—ï¸ ×¨×›×™×‘×™ React:"
        grep -r "export.*React\.FC\|export.*function.*(" src/ | wc -l
        echo "ğŸª React Hooks:"
        grep -r "use[A-Z]" src/ | wc -l
        echo "====================="

  code-analysis:
    runs-on: ubuntu-latest
    name: ğŸ§ª × ×™×ª×•×— ×§×•×“ ××ª×§×“×
    
    steps:
    - name: ğŸ“¥ Checkout ×§×•×“
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ ×”×ª×§× ×ª dependencies
      run: npm ci --only=dev
      
    - name: ğŸ” ×‘×“×™×§×ª Import Paths
      run: |
        echo "ğŸ” ×‘×•×“×§ import paths..."
        grep -r "import.*from.*\.\." src/ | head -10 || echo "âœ… ××™×Ÿ relative imports ×‘×¢×™×™×ª×™×™×"
        
    - name: ğŸ¨ ×‘×“×™×§×ª CSS Classes
      run: |
        echo "ğŸ¨ ×‘×•×“×§ ×©×™××•×© ×‘-CSS classes..."
        grep -r "className=" src/ | grep -E "(text-white|bg-white|text-black|bg-black)" | head -5 || echo "âœ… ××™×Ÿ ×©×™××•×© ×™×©×™×¨ ×‘×¦×‘×¢×™× ×§×©×™×—×™×"
        
    - name: ğŸ”§ ×‘×“×™×§×ª Console Logs
      run: |
        echo "ğŸ”§ ×‘×•×“×§ console.log statements..."
        grep -r "console\." src/ | grep -v "console.error\|console.warn" | head -10 || echo "âœ… ××™×Ÿ console.log ××™×•×ª×¨×™×"
        
    - name: ğŸ¯ ×‘×“×™×§×ª TODO Comments
      run: |
        echo "ğŸ¯ ××—×¤×© TODO comments..."
        grep -r "TODO\|FIXME\|XXX\|HACK" src/ | head -10 || echo "âœ… ××™×Ÿ TODO comments"
        
    - name: âš ï¸ ×‘×“×™×§×ª Any Types
      run: |
        echo "âš ï¸ ×‘×•×“×§ ×©×™××•×© ×‘-any types..."
        grep -r ": any\|any\[\]\|<any>" src/ | head -10 || echo "âœ… ××™×Ÿ ×©×™××•×© ×‘-any types"
        
    - name: ğŸ“‹ ×“×•×— × ×™×ª×•×— ××ª×§×“×
      if: always()
      run: |
        echo "ğŸ“‹ ×“×•×— × ×™×ª×•×— ×§×•×“ ××ª×§×“× ×”×•×©×œ× ×‘×”×¦×œ×—×”!"
        echo "×›×œ ×”×‘×“×™×§×•×ª ×¨×¦×• ×œ×œ× ×©×’×™××•×ª ×§×¨×™×˜×™×•×ª."