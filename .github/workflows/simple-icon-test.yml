name: Simple Icon Generation Test

on:
  workflow_dispatch:

jobs:
  test-icons:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Rust
      uses: dtolnay/rust-toolchain@stable
      
    - name: Install Tauri CLI
      run: cargo install tauri-cli --version "^2.0" --locked
      
    - name: Debug file system state
      run: |
        echo "🔍 Current working directory:"
        pwd
        echo "🔍 Listing repository structure:"
        find . -name "*.png" -type f
        echo "🔍 Detailed src-tauri directory:"
        ls -la src-tauri/
        echo "🔍 Checking if app-icon.png exists:"
        if [ -f src-tauri/app-icon.png ]; then
          echo "✅ File exists"
          echo "📏 File size:"
          stat src-tauri/app-icon.png
          echo "🔍 File type check:"
          file src-tauri/app-icon.png
          echo "🔍 Hex dump first 16 bytes:"
          hexdump -C src-tauri/app-icon.png | head -1
        else
          echo "❌ File does not exist!"
          exit 1
        fi
        
    - name: Generate icons
      run: |
        echo "🎨 Generating icons..."
        cd src-tauri
        cargo tauri icon app-icon.png
        
    - name: Verify generated icons
      run: |
        echo "🔍 Checking generated icons..."
        ls -la src-tauri/icons/
        for icon in src-tauri/icons/*.png; do
          if file "$icon" | grep -q "PNG image data"; then
            echo "✅ Valid: $icon"
          else
            echo "❌ Invalid: $icon"
          fi
        done