name: Simple Icon Generation Test

on:
  workflow_dispatch:

jobs:
  test-icons:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Rust
      uses: dtolnay/rust-toolchain@stable
      
    - name: Install Tauri CLI
      run: cargo install tauri-cli --version "^2.0" --locked
      
    - name: Debug file system state
      run: |
        echo "ğŸ” Current working directory:"
        pwd
        echo "ğŸ” Listing repository structure:"
        find . -name "*.png" -type f
        echo "ğŸ” Detailed src-tauri directory:"
        ls -la src-tauri/
        echo "ğŸ” Checking if app-icon.png exists:"
        if [ -f src-tauri/app-icon.png ]; then
          echo "âœ… File exists"
          echo "ğŸ“ File size:"
          stat src-tauri/app-icon.png
          echo "ğŸ” File type check:"
          file src-tauri/app-icon.png
          echo "ğŸ” Hex dump first 16 bytes:"
          hexdump -C src-tauri/app-icon.png | head -1
        else
          echo "âŒ File does not exist!"
          exit 1
        fi
        
    - name: Generate icons
      run: |
        echo "ğŸ¨ Generating icons..."
        cd src-tauri
        cargo tauri icon app-icon.png
        
    - name: Verify generated icons
      run: |
        echo "ğŸ” Checking generated icons..."
        ls -la src-tauri/icons/
        for icon in src-tauri/icons/*.png; do
          if file "$icon" | grep -q "PNG image data"; then
            echo "âœ… Valid: $icon"
          else
            echo "âŒ Invalid: $icon"
          fi
        done